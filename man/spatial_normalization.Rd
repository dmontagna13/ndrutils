% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/spatial_normalization.R
\name{spatial_normalization}
\alias{spatial_normalization}
\title{Spatially normalise plate data using a GAM surface trained on a uniformity plate}
\usage{
spatial_normalization(
  data,
  uniformity_plate,
  apply_to = NULL,
  k_prop = 0.6,
  plot = FALSE
)
}
\arguments{
\item{data}{A data frame containing at least the columns \code{well},
\code{val}, and \code{plate}. The plate layout is assumed to be consistent
(e.g. all 96‑well or all 384‑well).}

\item{uniformity_plate}{A single value (character/ numeric) identifying the
plate used to train the spatial surface.}

\item{apply_to}{A vector of plate identifiers to normalise using the trained
surface. Defaults to all plates except \code{uniformity_plate}.}

\item{k_prop}{Proportion of data points used to set the GAM basis dimension
(\code{k}); default \code{0.6}. \code{k = floor(n_points * k_prop)}.}

\item{plot}{Logical; if \code{TRUE}, returns a list with the modified data
and two ggplot objects (surface tile plots). Default \code{FALSE}.}
}
\value{
If \code{plot = FALSE}, returns a data frame the same size and shape
  as \code{data}, with normalised \code{val} for the specified plates.
  If \code{plot = TRUE}, returns a list:
  \itemize{
    \item \code{data}: the modified data frame
    \item \code{surface_plot}: ggplot of the fitted uniformity surface
    \item \code{example_plate_plot}: ggplot of one example normalised plate
  }
}
\description{
Fits a thin‑plate spline (via \code{mgcv::gam}) to the well values of a
designated \code{uniformity_plate} and uses the predicted surface to normalise
one or more target plates. The function is pipe‑friendly:

\preformatted{
  df %>%
    spatial_normalization(uniformity_plate = "U1", apply_to = c("P3","P4"))
}

Only the plates listed in \code{apply_to} are modified. For those plates,
\code{val} is divided by the corresponding predicted surface value at that
well position. All other rows are returned unchanged. The function infers
row/column indices from the \code{well} string (e.g. "A01", "P24").
}
